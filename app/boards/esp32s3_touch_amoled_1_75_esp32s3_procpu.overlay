// ESP32-S3 Reference Manual:
// https://www.espressif.com/sites/default/files/documentation/esp32-s3_technical_reference_manual_en.pdf

/ {
    aliases {
        intfs0 = &intfs0;
        modbus0 = &modbus0;
        gpio0buttons = &gpio0buttons;
    };

    chosen {
        zephyr,console = &usb_serial;
        zephyr,shell-uart = &usb_serial;
		zephyr,entropy = &trng0;
    };

    fstab {
        compatible = "zephyr,fstab";

        intfs0: intfs0 {
            compatible = "zephyr,fstab,littlefs";
            read-size = <16>;
			prog-size = <256>;
			cache-size = <256>;
			lookahead-size = <32>;
            block-cycles = <512>;
            partition = <&intfs0_partition>;
            mount-point = "/intfs0";
            automount;
        };
    };

    gpio0buttons: gpio0buttons {
		compatible = "gpio-keys";

		di_0: di_0 {
			gpios = <&gpio0 0 GPIO_PULL_UP>;
            zephyr,code = <INPUT_BTN_0>;
		};
	};
};

&flash0 {
	partitions {
		compatible = "fixed-partitions";
		#address-cells = <1>;
		#size-cells = <1>;

		intfs0_partition: partition@700000 {
			label = "intfs0_storage";
			reg = <0x700000 DT_SIZE_M(1)>; // 1MB at offset 7MB
		};
	};
};

&usb_serial {
    status = "okay";
};

&uart1 {
	status = "okay";
	current-speed = <115200>;
	pinctrl-0 = <&uart1_default>;
	pinctrl-names = "default";

    modbus0: modbus0 {
		compatible = "zephyr,modbus-serial";
		status = "okay";
	};
};

&pinctrl {
	uart1_default: uart1_default {
		group1 {
			pinmux = <UART1_TX_GPIO17>;
			output-high;
		};
		group2 {
			pinmux = <UART1_RX_GPIO16>;
			bias-pull-up;
		};
	};
};

&spi3 {
	status = "okay";
};
